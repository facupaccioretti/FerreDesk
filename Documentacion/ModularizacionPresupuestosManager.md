# Modularizaci√≥n de PresupuestosManager

## üìã **¬øQu√© es PresupuestosManager?**

PresupuestosManager es un **contenedor de formularios inteligente** que funciona como un **sistema de navegaci√≥n por tabs din√°micos** para el dominio de Presupuestos y Ventas. No es un simple CRUD, sino un **orquestador de experiencias de usuario**.

### **Arquitectura del Sistema**

- **Tabs Principales**: "Presupuestos y Ventas" y "Vendedores" (fijos)
- **Tabs Din√°micos**: Se crean/cierran seg√∫n acciones del usuario (nuevo presupuesto, editar, conversi√≥n, etc.)
- **Renderizado Condicional**: Diferentes formularios seg√∫n el tab activo
- **Estado Compartido**: Datos que se pasan entre todos los componentes

### **Componentes que Renderiza**

1. **PresupuestosList**: Tabla principal con filtros y paginaci√≥n
2. **PresupuestoForm**: Formulario para nuevos presupuestos
3. **VentaForm**: Formulario para nuevas facturas
4. **EditarPresupuestoForm**: Formulario de edici√≥n
5. **NotaCreditoForm**: Formulario de notas de cr√©dito
6. **ConVentaForm**: Formulario de conversi√≥n
7. **PresupuestoVentaVista**: Vista de solo lectura
8. **VendedoresTable**: Tabla de vendedores
9. **VendedorForm**: Formulario de vendedores

## üîç **Funcionalidades Actuales**

### **Gesti√≥n de Tabs Din√°micos**
- Crear/cerrar tabs din√°micamente
- Persistencia en localStorage
- Drag & drop para reordenar
- Limpieza de borradores al cerrar

### **CRUD Completo**
- Crear presupuestos y ventas
- Editar presupuestos existentes
- Eliminar comprobantes
- Gesti√≥n de vendedores

### **Operaciones de Negocio**
- Conversi√≥n de presupuestos a facturas
- Generaci√≥n de notas de cr√©dito
- Impresi√≥n de PDFs
- Filtros avanzados

### **Estados Compartidos**
- Configuraci√≥n de comprobantes
- Estados de modales
- Datos de conversi√≥n
- Filtros y paginaci√≥n

## ‚ö†Ô∏è **¬øPor qu√© Necesita Modularizaci√≥n?**

### **Problemas Actuales**
- **1516 l√≠neas** en un solo archivo
- **M√∫ltiples responsabilidades** mezcladas
- **L√≥gica compleja** dif√≠cil de mantener
- **Estados dispersos** y dif√≠ciles de rastrear
- **Funciones extensas** (50+ l√≠neas)
- **Renderizado condicional** complejo

### **Beneficios de la Modularizaci√≥n**
- **Mantenibilidad**: C√≥digo m√°s f√°cil de entender y modificar
- **Testabilidad**: Componentes m√°s peque√±os son m√°s f√°ciles de testear
- **Reutilizaci√≥n**: Hooks pueden usarse en otros componentes
- **Performance**: Re-renders m√°s eficientes
- **Legibilidad**: Navegaci√≥n m√°s clara en el c√≥digo

## üéØ **Plan de Modularizaci√≥n Detallado (Prioridad)**

### **1. PRIORIDAD ALTA - useTabsManager (150 l√≠neas)**

**¬øQu√© hace?**
- Gestiona el sistema de tabs din√°micos
- Maneja persistencia en localStorage
- Controla drag & drop de tabs
- Limpia borradores al cerrar tabs

**L√≠neas espec√≠ficas en PresupuestosManager:**
- **Estados**: L√≠neas 130-150 (tabs, activeTab, draggedTabKey)
- **Funciones**: L√≠neas 200-250 (openTab, closeTab)
- **Persistencia**: L√≠neas 700-720 (useEffect con localStorage)
- **Drag & Drop**: L√≠neas 850-900 (eventos onDragStart, onDrop, onDragEnd)

**Funciones que se extraen:**
- `openTab(key, label, data)` - L√≠neas 200-210
- `closeTab(key)` - L√≠neas 212-240
- `handleDragDrop()` - L√≠neas 850-900
- Estados: `tabs`, `activeTab`, `draggedTabKey`

**Componentes que se adaptan:**
- **PresupuestosManager**: Cambiar llamadas directas a `openTab`, `closeTab`, `setActiveTab`
- **Todos los formularios**: Recibir `closeTab` como prop para cerrar tabs
- **Tabla de tabs**: Usar `tabs`, `activeTab`, `draggedTabKey` del hook

**Funciones que se reutilizan:**
- `mainTabs` (l√≠nea 35) - Constante que define tabs principales
- `setEditVendedorData` - Se mantiene en PresupuestosManager

**Consecuencias de la modularizaci√≥n:**
- ‚úÖ **Exportar**: `tabs`, `activeTab`, `openTab`, `closeTab`, `setActiveTab`, `draggedTabKey`
- ‚úÖ **Adaptar**: PresupuestosManager, PresupuestoForm, VentaForm, EditarPresupuestoForm, NotaCreditoForm, ConVentaForm
- ‚úÖ **Beneficio**: L√≥gica de navegaci√≥n centralizada y reutilizable

---

### **2. PRIORIDAD ALTA - useComprobantesCRUD (200 l√≠neas)**

**¬øQu√© hace?**
- Operaciones CRUD de comprobantes (presupuestos, facturas, notas de cr√©dito, etc.)
- Manejo de conversiones entre tipos de comprobantes
- Gesti√≥n de modales de conversi√≥n
- Estados de loading espec√≠ficos

**L√≠neas espec√≠ficas en PresupuestosManager:**
- **Estados**: L√≠neas 160-170 (conversionModal, isFetchingForConversion, fetchingPresupuestoId)
- **Funciones CRUD**: L√≠neas 280-320 (handleEdit), 400-500 (handleImprimir), 500-550 (handleConvertir), 600-650 (handleDelete)
- **Funciones de conversi√≥n**: L√≠neas 550-650 (handleConversionConfirm, handleConVentaFormSave, handleConVentaFormCancel, handleConVentaFormSaveFacturaI)
- **Funciones de vista**: L√≠neas 650-670 (openVistaTab)

**Funciones que se extraen:**
- `handleEdit(comprobante)` - L√≠neas 280-320
- `handleImprimir(comprobante)` - L√≠neas 400-500
- `handleConvertir(comprobante)` - L√≠neas 500-550
- `handleDelete(id)` - L√≠neas 600-650
- `handleConversionConfirm(selectedItems)` - L√≠neas 550-580
- `handleConVentaFormSave(payload, tabKey)` - L√≠neas 580-620
- `handleConVentaFormCancel(tabKey)` - L√≠neas 620-625
- `handleConVentaFormSaveFacturaI(payload, tabKey, endpoint)` - L√≠neas 625-650
- `openVistaTab(comprobante)` - L√≠neas 650-670
- `handleConvertirFacturaI(facturaInterna)` - L√≠neas 750-780

**Componentes que se adaptan:**
- **ComprobantesList**: Recibir `onEdit`, `onDelete`, `onImprimir`, `onConvertir`, `onVerDetalle` como props
- **ConVentaForm**: Recibir `onSave`, `onCancel` como props
- **ConversionModal**: Recibir `onConvertir` como prop
- **PresupuestoVentaVista**: Recibir `onEliminar` como prop

**Funciones que se reutilizan:**
- `useVentasAPI()` - Hook existente (l√≠nea 110)
- `useGeneradorPDF()` - Hook existente (l√≠nea 95)
- `useFerreteriaAPI()` - Hook existente (l√≠nea 100)
- `getCookie()` - Utilidad existente (l√≠nea 25)

**Consecuencias de la modularizaci√≥n:**
- ‚úÖ **Exportar**: `comprobantes`, `handleEdit`, `handleDelete`, `handleImprimir`, `handleConvertir`, `conversionModal`, `isFetchingForConversion`, `fetchingPresupuestoId`
- ‚úÖ **Adaptar**: ComprobantesList, ConVentaForm, ConversionModal, PresupuestoVentaVista
- ‚úÖ **Beneficio**: L√≥gica de negocio centralizada y testable

---

### **3. PRIORIDAD MEDIA - useFiltrosComprobantes (150 l√≠neas)**

**¬øQu√© hace?**
- Filtros avanzados por tipo de comprobante, fecha, cliente, vendedor
- Normalizaci√≥n de datos de comprobantes
- Paginaci√≥n
- Transformaci√≥n de datos compleja

**L√≠neas espec√≠ficas en PresupuestosManager:**
- **Estados de filtros**: L√≠neas 120-130 (comprobanteTipo, comprobanteLetra, fechaDesde, fechaHasta, clienteId, vendedorId)
- **Estados de paginaci√≥n**: L√≠neas 170-175 (paginaActual, itemsPorPagina)
- **Mapas de datos**: L√≠neas 680-690 (productosPorId, clientesPorId)
- **Funci√≥n normalizadora**: L√≠neas 690-750 (normalizarComprobante)
- **Funci√≥n de filtros**: L√≠neas 720-740 (handleFiltroChange)
- **C√°lculos de paginaci√≥n**: L√≠neas 750-760 (totalItems, datosPagina)

**Funciones que se extraen:**
- `normalizarComprobante(comprobante)` - L√≠neas 690-750
- `handleFiltroChange(filtros)` - L√≠neas 720-740
- Estados: `comprobanteTipo`, `comprobanteLetra`, `fechaDesde`, `fechaHasta`, `clienteId`, `vendedorId`, `paginaActual`, `itemsPorPagina`
- Mapas: `productosPorId`, `clientesPorId`
- C√°lculos: `comprobantesNormalizados`, `totalItems`, `datosPagina`

**Componentes que se adaptan:**
- **ComprobantesList**: Recibir `comprobantesNormalizados`, `paginacion`, `filtros` como props
- **FiltrosPresupuestos**: Recibir `onFiltroChange` como prop
- **Paginador**: Recibir props de paginaci√≥n

**Funciones que se reutilizan:**
- `useProductosAPI()` - Hook existente (l√≠nea 105)
- `useClientesConDefecto()` - Hook existente (l√≠nea 115)
- `fetchVentas()` - Funci√≥n del hook useVentasAPI

**Consecuencias de la modularizaci√≥n:**
- ‚úÖ **Exportar**: `filtros`, `comprobantesNormalizados`, `paginacion`, `handleFiltroChange`, `productosPorId`, `clientesPorId`
- ‚úÖ **Adaptar**: ComprobantesList, FiltrosPresupuestos, Paginador
- ‚úÖ **Beneficio**: L√≥gica de filtrado optimizada y reutilizable

---

### **4. PRIORIDAD MEDIA - ComprobantesList (200 l√≠neas)**

**¬øQu√© hace?**
- Tabla principal de comprobantes (presupuestos, facturas, notas de cr√©dito, etc.)
- Filtros visuales
- Botones de acci√≥n por fila seg√∫n tipo de comprobante
- Paginaci√≥n visual

**L√≠neas espec√≠ficas en PresupuestosManager:**
- **JSX de filtros**: L√≠neas 950-970 (FiltrosPresupuestos)
- **JSX de botones de acci√≥n**: L√≠neas 970-1000 (botones Nuevo Presupuesto, Nueva Factura, etc.)
- **JSX de tabla**: L√≠neas 1000-1200 (tabla completa con thead y tbody)
- **JSX de paginaci√≥n**: L√≠neas 1200-1210 (Paginador)
- **L√≥gica de renderizado de acciones**: L√≠neas 1150-1200 (condiciones para mostrar botones seg√∫n tipo y estado)

**Componentes que se extraen:**
- Todo el JSX desde l√≠nea 950 hasta l√≠nea 1210
- L√≥gica de renderizado de botones de acci√≥n seg√∫n tipo de comprobante
- L√≥gica de tooltips de comprobantes asociados

**Componentes que se adaptan:**
- **PresupuestosManager**: Pasar props necesarias al nuevo componente
- **FiltrosPresupuestos**: Mantener funcionalidad existente
- **Paginador**: Mantener funcionalidad existente

**Funciones que se reutilizan:**
- `getComprobanteIconAndLabel()` - Funci√≥n existente (l√≠neas 40-50)
- `EstadoBadge` - Componente existente (l√≠neas 55-85)
- `formatearMoneda()` - Utilidad existente (l√≠nea 30)
- `ComprobanteAsociadoTooltip` - Componente existente (l√≠nea 32)

**Consecuencias de la modularizaci√≥n:**
- ‚úÖ **Exportar**: Componente completo con props
- ‚úÖ **Adaptar**: PresupuestosManager para pasar props
- ‚úÖ **Beneficio**: UI m√°s mantenible y reutilizable

---

### **5. PRIORIDAD MEDIA - VendedoresTab (120 l√≠neas)**

**¬øQu√© hace?**
- Tabla de vendedores
- Formularios de crear/editar vendedores
- B√∫squeda de vendedores

**L√≠neas espec√≠ficas en PresupuestosManager:**
- **Estados de vendedores**: L√≠neas 175-180 (searchVendedor, editVendedorData)
- **Funciones de vendedores**: L√≠neas 670-690 (handleNuevoVendedor, handleEditVendedor, handleSaveVendedor, handleDeleteVendedor)
- **JSX de vendedores**: L√≠neas 1250-1300 (tabla de vendedores y formularios)
- **JSX de formularios de vendedores**: L√≠neas 1300-1320 (VendedorForm)

**Funciones que se extraen:**
- `handleNuevoVendedor()` - L√≠neas 670-675
- `handleEditVendedor(vendedor)` - L√≠neas 675-680
- `handleSaveVendedor(data)` - L√≠neas 680-690
- `handleDeleteVendedor(id)` - L√≠neas 690-695
- Estados: `searchVendedor`, `editVendedorData`

**Componentes que se adaptan:**
- **PresupuestosManager**: Renderizar VendedoresTab condicionalmente
- **VendedoresTable**: Mantener funcionalidad existente
- **VendedorForm**: Mantener funcionalidad existente

**Funciones que se reutilizan:**
- `useVendedoresAPI()` - Hook existente (l√≠nea 120)
- `openTab()` - Funci√≥n del useTabsManager
- `closeTab()` - Funci√≥n del useTabsManager

**Consecuencias de la modularizaci√≥n:**
- ‚úÖ **Exportar**: Componente completo con props
- ‚úÖ **Adaptar**: PresupuestosManager para renderizar condicionalmente
- ‚úÖ **Beneficio**: Separaci√≥n clara de responsabilidades

---

### **6. PRIORIDAD BAJA - useVendedoresCRUD (80 l√≠neas)**

**¬øQu√© hace?**
- Operaciones CRUD b√°sicas de vendedores
- Estados de edici√≥n
- Manejo de formularios

**L√≠neas espec√≠ficas en PresupuestosManager:**
- **Hook useVendedoresAPI**: L√≠neas 120-130
- **Estados**: L√≠neas 175-180 (searchVendedor, editVendedorData)
- **Funciones CRUD**: L√≠neas 670-695 (handleSaveVendedor, handleDeleteVendedor)

**Funciones que se extraen:**
- Todo el hook `useVendedoresAPI()` - L√≠neas 120-130
- `handleSaveVendedor(data)` - L√≠neas 680-690
- `handleDeleteVendedor(id)` - L√≠neas 690-695
- Estados: `searchVendedor`, `editVendedorData`

**Componentes que se adaptan:**
- **VendedoresTab**: Usar el nuevo hook
- **PresupuestosManager**: Pasar datos del hook a VendedoresTab

**Funciones que se reutilizan:**
- `useVendedoresAPI()` - Hook existente
- `openTab()`, `closeTab()` - Funciones del useTabsManager

**Consecuencias de la modularizaci√≥n:**
- ‚úÖ **Exportar**: `vendedores`, `handleSaveVendedor`, `handleDeleteVendedor`, `searchVendedor`, `editVendedorData`
- ‚úÖ **Adaptar**: VendedoresTab para usar el hook
- ‚úÖ **Beneficio**: L√≥gica de vendedores centralizada

---

### **7. PRIORIDAD BAJA - useNotasCredito (100 l√≠neas)**

**¬øQu√© hace?**
- Gesti√≥n espec√≠fica de modales para notas de cr√©dito
- Selecci√≥n de clientes y facturas a anular
- Estados espec√≠ficos para el flujo de NC

**L√≠neas espec√≠ficas en PresupuestosManager:**
- **Estados de NC**: L√≠neas 180-185 (modalClienteNCAbierto, clienteParaNC, facturasParaNC, modalFacturasNCAbierto)
- **Funci√≥n principal**: L√≠neas 270-285 (handleNuevaNotaCredito)
- **JSX de modales**: L√≠neas 1400-1450 (ClienteSelectorModal, FacturaSelectorModal)

**Funciones que se extraen:**
- `handleNuevaNotaCredito()` - L√≠neas 270-285
- Estados: `modalClienteNCAbierto`, `clienteParaNC`, `facturasParaNC`, `modalFacturasNCAbierto`
- JSX de modales: L√≠neas 1400-1450

**Componentes que se adaptan:**
- **PresupuestosManager**: Usar el nuevo hook
- **ClienteSelectorModal**: Mantener funcionalidad existente
- **FacturaSelectorModal**: Mantener funcionalidad existente

**Funciones que se reutilizan:**
- `openTab()` - Funci√≥n del useTabsManager
- `setActiveTab()` - Funci√≥n del useTabsManager

**Consecuencias de la modularizaci√≥n:**
- ‚úÖ **Exportar**: `modalClienteNCAbierto`, `clienteParaNC`, `facturasParaNC`, `modalFacturasNCAbierto`, `handleNuevaNotaCredito`
- ‚úÖ **Adaptar**: PresupuestosManager para usar el hook
- ‚úÖ **Beneficio**: L√≥gica espec√≠fica de NC encapsulada

## üèóÔ∏è **Estructura Actual vs Propuesta**

### **ESTRUCTURA ACTUAL**
```
üìÅ components/Presupuestos y Ventas/
‚îú‚îÄ‚îÄ PresupuestosManager.js (1516 l√≠neas - archivo principal)
‚îú‚îÄ‚îÄ VentaForm.js (790 l√≠neas)
‚îú‚îÄ‚îÄ NotaCreditoForm.js (396 l√≠neas)
‚îú‚îÄ‚îÄ ItemsGrid.js (1195 l√≠neas)
‚îú‚îÄ‚îÄ ConversionModal.js (360 l√≠neas)
‚îú‚îÄ‚îÄ ConVentaForm.js (742 l√≠neas)
‚îú‚îÄ‚îÄ EditarPresupuestoForm.js (538 l√≠neas)
‚îú‚îÄ‚îÄ PresupuestoForm.js (591 l√≠neas)
‚îú‚îÄ‚îÄ VendedoresTable.js (68 l√≠neas)
‚îú‚îÄ‚îÄ VendedorForm.js (118 l√≠neas)
‚îú‚îÄ‚îÄ LibroIvaVentas/
‚îÇ   ‚îú‚îÄ‚îÄ LibroIvaVentasManager.js (196 l√≠neas)
‚îÇ   ‚îú‚îÄ‚îÄ LibroIvaExport.js (141 l√≠neas)
‚îÇ   ‚îú‚îÄ‚îÄ LibroIvaPeriodoSelector.js (228 l√≠neas)
‚îÇ   ‚îî‚îÄ‚îÄ LibroIvaTable.js (306 l√≠neas)
‚îî‚îÄ‚îÄ herramientasforms/
    ‚îú‚îÄ‚îÄ plantillasComprobantes/
    ‚îÇ   ‚îú‚îÄ‚îÄ PDF/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PlantillaFacturaAPDF.js (666 l√≠neas)
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PlantillaFacturaBPDF.js (650 l√≠neas)
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PlantillaFacturaCPDF.js (829 l√≠neas)
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useGeneradorPDF.js (77 l√≠neas)
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.js (5 l√≠neas)
    ‚îÇ   ‚îú‚îÄ‚îÄ PlantillaFacturaA.js (231 l√≠neas)
    ‚îÇ   ‚îú‚îÄ‚îÄ PlantillaFacturaB.js (175 l√≠neas)
    ‚îÇ   ‚îú‚îÄ‚îÄ PlantillaFacturaC.js (184 l√≠neas)
    ‚îÇ   ‚îî‚îÄ‚îÄ helpers.js (565 l√≠neas)
    ‚îú‚îÄ‚îÄ FiltrosPresupuestos.js (243 l√≠neas)
    ‚îú‚îÄ‚îÄ PresupuestoVentaVista.js (75 l√≠neas)
    ‚îú‚îÄ‚îÄ FacturaSelectorModal.js (271 l√≠neas)
    ‚îú‚îÄ‚îÄ ComprobanteAsociadoTooltip.js (156 l√≠neas)
    ‚îú‚îÄ‚îÄ useClientesConDefecto.js (50 l√≠neas)
    ‚îú‚îÄ‚îÄ useComprobanteFiscal.js (222 l√≠neas)
    ‚îú‚îÄ‚îÄ useFormularioDraft.js (87 l√≠neas)
    ‚îú‚îÄ‚îÄ useCalculosFormulario.js (204 l√≠neas)
    ‚îú‚îÄ‚îÄ SumarDuplicar.js (160 l√≠neas)
    ‚îú‚îÄ‚îÄ normalizadorItems.js (143 l√≠neas)
    ‚îú‚îÄ‚îÄ mapeoItems.js (88 l√≠neas)
    ‚îú‚îÄ‚îÄ MapeoVentaDetalle.js (72 l√≠neas)
    ‚îú‚îÄ‚îÄ manejoFormulario.js (54 l√≠neas)
    ‚îî‚îÄ‚îÄ valoresPorDefecto.js (19 l√≠neas)
```

### **ESTRUCTURA PROPUESTA DESPU√âS DE MODULARIZACI√ìN**
```
üìÅ components/Presupuestos y Ventas/
‚îú‚îÄ‚îÄ PresupuestosManager.js (400 l√≠neas - orquestador principal)
‚îú‚îÄ‚îÄ PresupuestosList.js (200 l√≠neas - tabla principal)
‚îú‚îÄ‚îÄ VendedoresTab.js (120 l√≠neas - gesti√≥n vendedores)
‚îú‚îÄ‚îÄ VentaForm.js (790 l√≠neas - mantener)
‚îú‚îÄ‚îÄ NotaCreditoForm.js (396 l√≠neas - mantener)
‚îú‚îÄ‚îÄ ItemsGrid.js (1195 l√≠neas - mantener)
‚îú‚îÄ‚îÄ ConversionModal.js (360 l√≠neas - mantener)
‚îú‚îÄ‚îÄ ConVentaForm.js (742 l√≠neas - mantener)
‚îú‚îÄ‚îÄ EditarPresupuestoForm.js (538 l√≠neas - mantener)
‚îú‚îÄ‚îÄ PresupuestoForm.js (591 l√≠neas - mantener)
‚îú‚îÄ‚îÄ VendedoresTable.js (68 l√≠neas - mantener)
‚îú‚îÄ‚îÄ VendedorForm.js (118 l√≠neas - mantener)
‚îú‚îÄ‚îÄ LibroIvaVentas/ (mantener estructura actual)
‚îÇ   ‚îú‚îÄ‚îÄ LibroIvaVentasManager.js
‚îÇ   ‚îú‚îÄ‚îÄ LibroIvaExport.js
‚îÇ   ‚îú‚îÄ‚îÄ LibroIvaPeriodoSelector.js
‚îÇ   ‚îî‚îÄ‚îÄ LibroIvaTable.js
‚îú‚îÄ‚îÄ hooks/ (NUEVA CARPETA)
‚îÇ   ‚îú‚îÄ‚îÄ useTabsManager.js (150 l√≠neas - extra√≠do de PresupuestosManager)
‚îÇ   ‚îú‚îÄ‚îÄ useComprobantesCRUD.js (200 l√≠neas - extra√≠do de PresupuestosManager)
‚îÇ   ‚îú‚îÄ‚îÄ useFiltrosComprobantes.js (150 l√≠neas - extra√≠do de PresupuestosManager)
‚îÇ   ‚îú‚îÄ‚îÄ useVendedoresCRUD.js (80 l√≠neas - extra√≠do de PresupuestosManager)
‚îÇ   ‚îî‚îÄ‚îÄ useNotasCredito.js (100 l√≠neas - extra√≠do de PresupuestosManager)
‚îî‚îÄ‚îÄ herramientasforms/ (mantener estructura actual)
    ‚îú‚îÄ‚îÄ plantillasComprobantes/
    ‚îÇ   ‚îú‚îÄ‚îÄ PDF/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PlantillaFacturaAPDF.js
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PlantillaFacturaBPDF.js
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PlantillaFacturaCPDF.js
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useGeneradorPDF.js
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.js
    ‚îÇ   ‚îú‚îÄ‚îÄ PlantillaFacturaA.js
    ‚îÇ   ‚îú‚îÄ‚îÄ PlantillaFacturaB.js
    ‚îÇ   ‚îú‚îÄ‚îÄ PlantillaFacturaC.js
    ‚îÇ   ‚îî‚îÄ‚îÄ helpers.js
    ‚îú‚îÄ‚îÄ FiltrosPresupuestos.js
    ‚îú‚îÄ‚îÄ PresupuestoVentaVista.js
    ‚îú‚îÄ‚îÄ FacturaSelectorModal.js
    ‚îú‚îÄ‚îÄ ComprobanteAsociadoTooltip.js
    ‚îú‚îÄ‚îÄ useClientesConDefecto.js
    ‚îú‚îÄ‚îÄ useComprobanteFiscal.js
    ‚îú‚îÄ‚îÄ useFormularioDraft.js
    ‚îú‚îÄ‚îÄ useCalculosFormulario.js
    ‚îú‚îÄ‚îÄ SumarDuplicar.js
    ‚îú‚îÄ‚îÄ normalizadorItems.js
    ‚îú‚îÄ‚îÄ mapeoItems.js
    ‚îú‚îÄ‚îÄ MapeoVentaDetalle.js
    ‚îú‚îÄ‚îÄ manejoFormulario.js
    ‚îî‚îÄ‚îÄ valoresPorDefecto.js
```

### **CAMBIOS ESPEC√çFICOS**

#### **1. NUEVA CARPETA: `hooks/`**
**Ubicaci√≥n**: `components/Presupuestos y Ventas/hooks/`
**Prop√≥sito**: Contener todos los hooks personalizados extra√≠dos de PresupuestosManager
**Archivos a crear**:
- `useTabsManager.js` - Gesti√≥n de tabs din√°micos
- `useComprobantesCRUD.js` - Operaciones CRUD de comprobantes (presupuestos, facturas, NC, etc.)
- `useFiltrosComprobantes.js` - Filtros y normalizaci√≥n de comprobantes
- `useVendedoresCRUD.js` - Operaciones CRUD de vendedores
- `useNotasCredito.js` - Gesti√≥n espec√≠fica de notas de cr√©dito

#### **2. NUEVOS COMPONENTES**
**Ubicaci√≥n**: `components/Presupuestos y Ventas/`
**Archivos a crear**:
- `ComprobantesList.js` - Tabla principal de comprobantes extra√≠da de PresupuestosManager
- `VendedoresTab.js` - Gesti√≥n de vendedores extra√≠da de PresupuestosManager

#### **3. ARCHIVOS QUE SE MANTIENEN**
- Todos los formularios existentes (VentaForm, NotaCreditoForm, etc.)
- Toda la carpeta `herramientasforms/` con su estructura actual
- Toda la carpeta `LibroIvaVentas/` con su estructura actual
- Todos los componentes de utilidad existentes

#### **4. ARCHIVO PRINCIPAL REFACTORIZADO**
- `PresupuestosManager.js` - Reducido de 1516 a ~400 l√≠neas
- Se convierte en un orquestador que usa los nuevos hooks
- Mantiene la l√≥gica de renderizado condicional de tabs

## üìä **Resultado Esperado**

- **PresupuestosManager**: 1516 ‚Üí 400 l√≠neas (74% reducci√≥n)
- **C√≥digo total**: Mismo n√∫mero de l√≠neas, pero mejor organizado
- **Mantenibilidad**: Significativamente mejorada
- **Testabilidad**: Componentes m√°s peque√±os y enfocados
- **Reutilizaci√≥n**: Hooks pueden usarse en otros lugares

## üöÄ **Plan de Implementaci√≥n**

1. **Fase 1**: Extraer `useTabsManager` y `useComprobantesCRUD`
2. **Fase 2**: Extraer `useFiltrosComprobantes` y `ComprobantesList`
3. **Fase 3**: Extraer `VendedoresTab` y `useVendedoresCRUD`
4. **Fase 4**: Extraer `useNotasCredito` y limpieza final

Cada fase debe incluir:
- Creaci√≥n del nuevo archivo
- Migraci√≥n de c√≥digo
- Actualizaci√≥n de imports
- Testing de funcionalidad
- Refinamiento seg√∫n feedback 